<script type="text/html" id="algorithm-view-template">
    <!-- ko with: $data -->
    <div class="algorithm-view-holder">
        <!-- ko if: addonsTemplate -->
        <div class="algorithm-addons" data-bind="style: { 'width': addonsWidth() + 'px' }">
            <!-- ko foreach: blocks -->
            <div class="algorithm-addon-holder" data-bind="style: { 'height': height() + 'px', 'marginBottom': $parent.blockMinDistance() + 'px' }">
                <!-- ko template: $parent.addonsTemplate -->
                <!-- /ko -->
            </div>
            <!-- /ko -->
        </div>
        <!-- /ko -->
        <div class="algorithm-transitions" data-bind="style: { 'left': addonsWidth() + 'px', 'width': connectorsAreaWidth() + 'px' }">
            <!-- ko foreach: transitions -->
            <!-- ko template: template -->
            <!-- /ko -->
            <!-- /ko -->
        </div>
        <div class="algorithm-blocks" data-bind="draggableblocks: $data, style: { 'left': addonsWidth() + connectorsAreaWidth() + 'px', width: blockWidth() + 'px' }">
            <!-- ko foreach: blocks -->
            <!-- ko template: template -->
            <!-- /ko -->
            <!-- /ko -->
        </div>
        <div class="algorithm-comments" data-bind="style: { 'top': -blockMinDistance() + 'px', 'left': addonsWidth() + connectorsAreaWidth() + blockWidth() + 'px', width: commentWidth() + 'px' }">
            <!-- ko foreach: blocks -->
            <div style="position: relative" data-bind="style: { 'height': height() + 'px', 'lineHeight': height() + 'px', 'margin': $parent.blockMinDistance() + 'px 0' }">
                <!-- ko if: comment -->
                <div style="position:absolute; top: 0; left:0; width: 40px; height: 100%">
                    <svg width="100%" height="100%">
                        <line y1="50%" y2="50%" x1="0%" x2="100%" style="stroke:black;stroke-width:0.5;stroke-dasharray:10 5;"></line>
                    </svg>
                </div>
                <div class="algorithm-comment-content">
                    <span data-bind="text: comment"></span>
                </div>
                <!-- /ko -->
            </div>
            <!-- /ko -->
        </div>
        <div class="algorithm-block-details-container" data-bind="algodetails: $data">
        </div>
    </div>
    <!-- /ko -->
</script>

<script type="text/html" id="algorithm-details-template">
    <div class="algorithm-details-holder">
        <div class="algorithm-details-template-holder">
            <!-- ko template: { name: detailTemplate, data: currentBlock } -->
            <!-- /ko -->
        </div>
        <div class="algorithm-details-actions-holder">
            <div class="algorithm-button" data-bind="click: function() { $data.isEditMode(false); }, text: Algorithm.AlgorithmViewModel.closeTitle"></div>
        </div>
    </div>
</script>

<script type="text/html" id="algorithm-default-details-template">
    <!-- ko with: $data -->
    <div class="algo-detail-field">
        <span class="algo-detail-label">Text: </span>
        <div class="algo-detail-value-wrapper">
            <input class="algo-detail-value" data-bind="value: text" />
        </div>
    </div>
    <div class="algo-detail-field">
        <span class="algo-detail-label">Comment: </span>
        <div class="algo-detail-value-wrapper">
            <input class="algo-detail-value" data-bind="value: comment" />
        </div>
    </div>
    <div class="algo-detail-field">
        <span class="algo-detail-label">State: </span>
        <div class="algo-detail-value-wrapper">
            <select data-bind="options: [ 'inprogress', 'completed' ], value: state, optionsCaption: 'Choose state...'"></select>
        </div>
    </div>
    <div class="algo-detail-field">
        <span class="algo-detail-label">Is Condition: </span>
        <div class="algo-detail-value-wrapper">
            <input type="checkbox" data-bind="checked: isCondition" />
        </div>
    </div>
    <!-- /ko -->
</script>
<script type="text/html" id="algorithm-block-item-template">
    <div class="algorithm-block algorithm-block-item" data-bind="style: { 'height': height() + 'px', 'lineHeight': height() + 'px', 'margin': $parent.blockMinDistance() + 'px 0' }, css: { 'algorithm-block-inprogress': state() === 'inprogress', 'algorithm-block-teminator': isTerminator }, click: function() { $parent.clickBlock($data); }">
        <div class="algorithm-block-shadow"></div>
        <div class="algorithm-block-content" data-bind="style: { 'lineHeight': height() + 'px' }, text: text"></div>
        <!-- ko if: num() -->
        <div style="position:absolute; top:-0.5em; line-height: 1em; left:15px; background-color: white;" data-bind="text: num"></div>
        <!-- /ko -->
        <!-- ko if: state() === "completed" -->
        <div style="position:absolute; top:-0.5em; line-height: 1em; right:15px;">
            <span style="color: green; font-family: wingdings; font-size: 200%;">&#252;</span><!-- &#251; -->
        </div>
        <!-- /ko -->
        <!-- ko template: "algorithm-block-controls" -->
        <!-- /ko -->
    </div>
</script>

<script type="text/html" id="algorithm-block-condition-template">
    <div class="algorithm-block algorithm-block-condition" data-bind="style: { 'height': height() + 'px', 'lineHeight': height() + 'px', 'margin': $parent.blockMinDistance() + 'px 0' }, click: function() { $parent.clickBlock($data); }">
        <div class="algorithm-block-shadow">
            <svg width='100%' height='100%' style="position:absolute;left:0;">
                <defs>
                    <filter id="algorithm-block-shadow-filter" x="-0.5" y="-0.5" width="200%" height="200%">
                        <feOffset result="offOut" in="SourceAlpha" dx="0" dy="0" />
                        <feGaussianBlur result="blurOut" in="offOut" stdDeviation="0.1" />
                        <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />
                    </filter>
                </defs>
                <polygon data-bind="attr: { 'points': '0 ' + height()/2 + ', ' + $parent.blockWidth()/2 + ' 0, ' + $parent.blockWidth() + ' ' + height()/2 + ', ' + $parent.blockWidth()/2 + ' ' + height() }" style="stroke:gray;stroke-width:1" filter="url(#algorithm-block-shadow-filter)" />
            </svg>
        </div>
        <svg height="100%" width="100%" style="position:absolute;left:0;">
            <polygon data-bind="attr: { 'points': '0 ' + height()/2 + ', ' + $parent.blockWidth()/2 + ' 0, ' + $parent.blockWidth() + ' ' + height()/2 + ', ' + $parent.blockWidth()/2 + ' ' + height() }" style="fill:white;stroke:black;stroke-width:1" />
        </svg>
        <div class="algorithm-condition-content" data-bind="style: { 'lineHeight': height() + 'px' }, text: text"></div>
        <!-- ko if: num() -->
        <div style="position:absolute; bottom:50%; line-height: 1em; left:15px; background-color: white;" data-bind="text: num"></div>
        <!-- /ko -->
        <!-- ko template: "algorithm-block-controls" -->
        <!-- /ko -->
    </div>
</script>

<script type="text/html" id="algorithm-block-controls">
    <!-- ko if: $parent.allowEdit -->
    <div class="algorithm-block-controls">
        <div class="algorithm-block-command algorithm-hint algorithm-block-command-add" data-bind="click: function() { $parent.addBlock($data, true); }, attr: { 'data-title': $parent.addBeforeTitle }"></div>
        <div class="algorithm-block-command algorithm-hint algorithm-block-command-edit" data-bind="click: function() { $parent.editBlock($data); }, attr: { 'data-title': $parent.editTitle }"></div>
        <!-- ko ifnot: isCondition -->
        <div class="algorithm-block-command algorithm-hint algorithm-block-command-connect" draggable="true" data-bind="attr: { 'data-title': $parent.connectTitle }"></div>
        <!-- /ko -->
        <!-- ko if: $parent.blocks().length > 1 -->
        <div class="algorithm-block-command algorithm-hint algorithm-block-command-remove" data-bind="click: function() { $parent.removeBlock($data); }, attr: { 'data-title': $parent.removeTitle }"></div>
        <!-- /ko -->
        <div class="algorithm-block-command algorithm-hint algorithm-block-command-add" data-bind="click: function() { $parent.addBlock($data); }, attr: { 'data-title': $parent.addAfterTitle }"></div>
    </div>
    <div class="algorithm-condition-connector algorithm-condition-connector-no algorithm-hint" draggable="true" data-bind="style: { 'top': height()/2-8 + 'px' }, attr: { 'data-title': $parent.noTitle, 'data-transition': $parent.noTitle }"></div>
    <!-- ko if: isCondition -->
    <div class="algorithm-condition-connector algorithm-condition-connector-yes algorithm-hint" draggable="true" data-bind="style: { 'top': height()/2-8 + 'px' }, attr: { 'data-title': $parent.yesTitle }"></div>
    <!-- /ko -->
    <!-- /ko -->
</script>

<script type="text/html" id="algorithm-tr-direct-template">
    <div style="width:1px; border:1px solid black; border-right:none; position:absolute;" data-bind="style: { top: startBlock().posY() + startBlock().height() + 'px', height: $parent.blockMinDistance() + 'px', left: $parent.connectorsAreaWidth() + $parent.blockWidth() / 2 + 'px' }">
        <div class="connector-direct-arrow">
            <svg width="100%" height="100%">
                <line y1="50%" y2="100%" x1="25%" x2="50%" style="stroke:black;stroke-width:1"></line>
                <line y1="50%" y2="100%" x1="75%" x2="50%" style="stroke:black;stroke-width:1"></line>
            </svg>
        </div>
        <!-- ko if: label() -->
        <div style="position:absolute; top:-2px; left:6px; background-color: white;" data-bind="text: label"></div>
        <!-- /ko -->
    </div>
</script>

<script type="text/html" id="algorithm-tr-far-up-template">
    <div style="border:1px solid black; border-right:none; border-radius: 5px 0 0 5px; position:absolute;" data-bind="style: { top: (endBlock().posY() + endBlock().height() / 2) + 'px', height: (startBlock().posY() - endBlock().posY()) + 'px', left: ($parent.connectorsAreaWidth() - level() * $parent.blockMinDistance()) + 'px', width: level() * $parent.blockMinDistance() + 'px' }">
        <div class="connector-far-up-arrow">
            <svg width="100%" height="100%">
                <line y1="25%" y2="50%" x1="50%" x2="100%" style="stroke:black;stroke-width:1"></line>
                <line y1="75%" y2="50%" x1="50%" x2="100%" style="stroke:black;stroke-width:1"></line>
            </svg>
        </div>
        <!-- ko if: label() -->
        <div class="connector-label" data-bind="text: label"></div>
        <!-- /ko -->
    </div>
</script>

<script type="text/html" id="algorithm-tr-far-down-template">
    <div style="border:1px solid black; border-right:none; border-radius: 5px 0 0 5px; position:absolute;" data-bind="style: { top: (startBlock().posY() + startBlock().height() / 2) + 'px', height: (endBlock().posY() - startBlock().posY()) + 'px', left: ($parent.connectorsAreaWidth() - level() * $parent.blockMinDistance()) + 'px', width: level() * $parent.blockMinDistance() + 'px' }">
        <div class="connector-far-down-arrow">
            <svg width="100%" height="100%">
                <line y1="25%" y2="50%" x1="50%" x2="100%" style="stroke:black;stroke-width:1"></line>
                <line y1="75%" y2="50%" x1="50%" x2="100%" style="stroke:black;stroke-width:1"></line>
            </svg>
        </div>
        <!-- ko if: label() -->
        <div class="connector-label" data-bind="text: label"></div>
        <!-- /ko -->
    </div>
</script>
